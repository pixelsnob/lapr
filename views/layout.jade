doctype html
html
  head
    title 

    link(rel="stylesheet", href="/dist/css/main.css")
    if user
      link(rel="stylesheet", href="/dist/css/cms.css")
      link(rel="stylesheet", href="/bower_components/vex/css/vex.css")
      link(rel="stylesheet", href="/bower_components/vex/css/vex-theme-plain.css")

    style(type="text/css", media="screen")
      | body { font: 13px arial; }
      | table { border-collapse: none; width: 100%; }
      | td, th {
      |   padding: 1px;
      |   background: #f7f7f7;
      |   white-space: nowrap;
      |   font-size: 11px;
      | }
      | td._description { white-space: normal; min-width: 100px; }
    
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    meta(name="csrf-param", content="#{csrf}")
    meta(http-equiv="Content-Type", content="text/html;charset=utf-8")

  body(class="#{body_class}")
    block content 

    script(type="text/javascript").
      // Various polyfills
      [].filter||(Array.prototype.filter=function(a,b,c,d,e){c=this;d=[];for(e in c)~~e+''==e&&e>=0&&a.call(b,c[e],+e,c)&&d.push(c[e]);return d});
      Object.keys=Object.keys||function(o,k,r){r=[];for(k in o)r.hasOwnProperty.call(o,k)&&r.push(k);return r};
      Array.isArray||(Array.isArray=function(a){return''+a!==a&&{}.toString.call(a)=='[object Array]'});
      window.lapr = { env: '#{settings.env}' };

    if user
      script(type="text/javascript").
        window.lapr.user = !{JSON.stringify(user)};
        window.lapr.markdown_opts = !{JSON.stringify(marked_opts)};
    
    if settings.env == 'production'
      script(type="text/javascript", src="/dist/js/main/app.js")
      if user
        script(type="text/javascript", src="/dist/js/cms/app.js")
    else
      script(type="text/javascript", src="/bower_components/requirejs/require.js")


    if user
      script(type="text/javascript").
        require.config({ baseUrl: '/js' });
        require([ 'config' ], function() {
          require([ 'main/app', 'cms/app' ]);
        });
    else
      script(type="text/javascript").
        require.config({ baseUrl: '/js' });
        require([ 'config' ], function() {
          require([ 'main/app' ]);
        });
